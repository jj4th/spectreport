var _createClass=require("babel-runtime/helpers/create-class")["default"],_classCallCheck=require("babel-runtime/helpers/class-call-check")["default"],_Object$assign=require("babel-runtime/core-js/object/assign")["default"],_Object$getOwnPropertyNames=require("babel-runtime/core-js/object/get-own-property-names")["default"],_getIterator=require("babel-runtime/core-js/get-iterator")["default"];!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.spectreport=e()}(this,function(){"use strict";var t=function(){function t(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0],s=arguments.length<=1||void 0===arguments[1]?0:arguments[1],r=arguments.length<=2||void 0===arguments[2]?0:arguments[2],i=arguments.length<=3||void 0===arguments[3]?0:arguments[3];_classCallCheck(this,t),this.tests=e,this.pending=s,this.failures=r,this.duration=i,this.timeStart=null,this.timeStop=null}return _createClass(t,[{key:"add",value:function(t){this.tests+=t.tests,this.pending+=t.pending,this.failures+=t.failures}}],[{key:"fromObject",value:function(e){var s=new t;return _Object$assign(s,e)}}]),t}(),e=require("crypto"),s=function(){function t(e,s,r){var i=this;_classCallCheck(this,t),this.status=s,this.title=String(e.title),this.fullTitle=e.fullTitle(),this.duration=Math.round(e.duration/10)/100,this.error=null,r&&(this.error={},_Object$getOwnPropertyNames(r).forEach(function(t){i.error[t]=r[t]}))}return _createClass(t,[{key:"hash",get:function(){return e.createHash("sha1").update(JSON.stringify(this)).digest("hex")}}],[{key:"fromObject",value:function(e){var s={fullTitle:function(){return null}};(void 0===e.error||null===e.error)&&delete e.error;var r=new t(s);return _Object$assign(r,e)}}]),t}();s.TEST_PENDING=2,s.TEST_PASS=1,s.TEST_FAIL=0;var r=function(){function e(s,r){_classCallCheck(this,e),this.title=s.title,this.file=s.file,this.suites=[],this.tests=[],this.parent=r,this.stats=new t}return _createClass(e,[{key:"addStats",value:function(t){this.stats.add(t)}},{key:"addSuite",value:function(t){return t.hasTests()?(this.suites.push(t),void this.addStats(t.stats)):!1}},{key:"addTest",value:function(t){this.tests.push(t),this.stats.tests++,t.status===s.TEST_PENDING?this.stats.pending++:t.status===s.TEST_FAIL&&this.stats.failures++}},{key:"hasTests",value:function(){return this.stats.tests>0}},{key:"start",value:function(t){this.stats.timeStart=t||Date.now()}},{key:"stop",value:function(t,e){return!e&&!this.stats.timeStart>0?!1:(this.stats.timeStop=t||Date.now(),void(this.stats.duration=e||Math.round((this.stats.timeStop-this.stats.timeStart)/10)/100))}},{key:"fixTimeStats",value:function(){var t=!0,e=!1,s=void 0;try{for(var r,i=_getIterator(this.suites);!(t=(r=i.next()).done);t=!0){var a=r.value;(null===this.stats.timeStart||this.stats.timeStart>a.stats.timeStart)&&(this.stats.timeStart=a.stats.timeStart),(null===this.stats.timeStop||this.stats.timeStop<a.stats.timeStop)&&(this.stats.timeStop=a.stats.timeStop),this.stats.duration=Math.round((this.stats.timeStop-this.stats.timeStart)/10)/100}}catch(n){e=!0,s=n}finally{try{!t&&i["return"]&&i["return"]()}finally{if(e)throw s}}}},{key:"toJSON",value:function(){var t={title:this.title,file:this.file,suites:this.suites,tests:this.tests,stats:this.stats};return t}}],[{key:"fromObject",value:function(r,i){var a=new e(r,i),n=[],u=[],l=null;l=t.fromObject(r.stats),_Object$assign(a,{stats:l});var o=!0,h=!1,c=void 0;try{for(var f,d=_getIterator(r.suites);!(o=(f=d.next()).done);o=!0){var m=f.value;n.push(e.fromObject(m,a))}}catch(p){h=!0,c=p}finally{try{!o&&d["return"]&&d["return"]()}finally{if(h)throw c}}_Object$assign(a,{suites:n});var v=!0,g=!1,y=void 0;try{for(var S,b=_getIterator(r.tests);!(v=(S=b.next()).done);v=!0){var j=S.value;u.push(s.fromObject(j))}}catch(p){g=!0,y=p}finally{try{!v&&b["return"]&&b["return"]()}finally{if(g)throw y}}return _Object$assign(a,{tests:u}),a}}]),e}(),i=require("fs-extra"),a=require("path"),n=function(){function t(e,s){_classCallCheck(this,t),this.jsonDir=e,this.results=new r({title:s}),this.lookupKeyPaths={}}return _createClass(t,[{key:"listFiles",value:function(t,e){t=t||this.jsonDir,e=e||[];var s=i.readdirSync(t),r=!0,n=!1,u=void 0;try{for(var l,o=_getIterator(s);!(r=(l=o.next()).done);r=!0){var h=l.value;h=a.join(t,h),i.statSync(h).isDirectory()?e=this.listFiles(h,e):h.indexOf(".json")>0&&e.push(h)}}catch(c){n=!0,u=c}finally{try{!r&&o["return"]&&o["return"]()}finally{if(n)throw u}}return e}},{key:"addJsonObject",value:function(t,e){for(var s=this.lookupKeyPaths,i=r.fromObject(e),a=i,n=void 0;t.length;){if(n=s[t.join("|")],!n){var u=t[t.length-1];n=new r({title:u}),s[t.join("|")]=n}a.parent!==n?(a.parent=n,n.addSuite(a)):n.addStats(i.stats),n.fixTimeStats(),a=n,t.pop()}n=this.results,a.parent!==n?(a.parent=n,n.addSuite(a)):n.addStats(i.stats),n.fixTimeStats()}},{key:"addJsonFileList",value:function(t){var e=!0,s=!1,r=void 0;try{for(var n,u=_getIterator(t);!(e=(n=u.next()).done);e=!0){var l=n.value,o=a.relative(this.jsonDir,a.dirname(l)),h=o.split(a.sep),c=null;""===h[0]&&h.shift();try{c=i.readJsonSync(l),this.addJsonObject(h,c)}catch(f){throw new Error("There was a problem reading a results file: "+l+".\n"+f.message)}}}catch(d){s=!0,r=d}finally{try{!e&&u["return"]&&u["return"]()}finally{if(s)throw r}}}},{key:"scan",value:function(){var t=null;try{t=this.listFiles()}catch(e){throw new Error("There was a problem reading the results directory.\n"+e.message)}return this.addJsonFileList(t),this.results}}]),t}(),u=require("fs-extra"),l=require("dot"),o=require("path"),h={outputHtml:"test/results/index.html",jsonDir:"test/results",template:o.join(o.relative(".",__dirname),"assets/results.dot"),suiteTitle:"Test Results"},c=function(){function t(e){_classCallCheck(this,t),this.results=null,this.opts=_Object$assign({},h,e),this.aggregator=new n(this.opts.jsonDir,this.opts.suiteTitle)}return _createClass(t,[{key:"scan",value:function(){try{this.results=this.aggregator.scan()}catch(t){throw t.message="There was a problem aggregating the JSON results.\n"+t.message,t}if(!this.results||!this.results.stats)throw new Error("No results were found.  Did you run the tests?")}},{key:"report",value:function(){this.results||this.scan();try{var t=u.readFileSync(this.opts.template),e=l.template(t);this.reportHtml=e(this.results)}catch(s){throw s.message="There was a problem rendering the HTML report.\n"+s.message,s}}},{key:"output",value:function(t){this.reportHtml||this.report(),t=t||this.opts.outputHtml;try{u.writeFileSync(t,this.reportHtml)}catch(e){throw e.message="There was a problem outputting the HTML report to disk.\n"+e.message,e}}},{key:"summary",value:function(){return this.results||this.scan(),this.results.stats}}]),t}();return c.Stats=t,c.Suite=r,c.Test=s,c.DefaultOptions=h,c});
//# sourceMappingURL=spectreport.min.js.map
